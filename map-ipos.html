<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=c2660934bdd79ee31dc6f30113f44d85"></script>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
    <style>
    	#mapwarp{top:0;bottom:0;position:absolute;left:0;right:0;}
    	.poptitle{color:#3366FF;}
    </style>
</head>
<body>
	<div id='mapwarp'></div>
	
<script>
//5476c83be4b068ad0ea3ad74
var mapObj,userLoc,targetLoc;
var ipodata;
var topView;

function mapInit() {
	mapObj = new AMap.Map("mapwarp",{
		dragEnable:true,
		zoomEnable:true,
		zooms:[3,18],
		view: new AMap.View2D({
			zoom:15
		})
	});
	mapObj.plugin(["AMap.ToolBar"],function(){	
		toolBar = new AMap.ToolBar();
		mapObj.addControl(toolBar);
        AMap.event.addListener(toolBar, "location", function(e){
        	if(e.lnglat)
        	mui.fire(topView,'listen',{lnglat:e.lnglat.lng+','+e.lnglat.lat});
//      	userLoc = e.lnglat;
        });
		toolBar.doLocation();
	});
}

window.addEventListener('catchData',function(e){
//	alert(e.detail.datas.length)
//	ipodata = e.detail.datas;
//	makePoint
});

mui.plusReady(function(){
//	topView = plus.webview.getWebviewById('shop-list.html');
	topView = plus.webview.currentWebview().parent();
	alert(topView)
});


//function cloudSearch() {
//	mapObj.clearMap();
//  var arr = new Array();   
//  var center = new AMap.LngLat(searchLoc.lng,searchLoc.lat);  
//  var search;
//  var searchOptions = {
//      keywords:'小红帽',
//      orderBy:'_id:ASC'
//  };
//  //加载CloudDataSearch服务插件
//  mapObj.plugin(["AMap.CloudDataSearch"], function() {
//      search = new AMap.CloudDataSearch('5476c83be4b068ad0ea3ad74', searchOptions); //构造云数据检索类
//      AMap.event.addListener(search, "complete", cloudSearchOk); //查询成功时的回调函数
//      AMap.event.addListener(search, "error", cloudSearchFail); //查询失败时的回调函数
//      search.searchNearBy(center, 3000); //周边检索
//  });
//}
//
//function cloudSearchOk(data){
//	console.log(data)
//}
//function cloudSearchFail(data){
//	console.log(data)
//}


mapInit();
</script>
</body>
</html>