<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
    <style>
    	.mui-content{background: #fff;}
    	.mui-bar-nav span,.mui-bar-nav a{text-align: center;line-height:44px;width:33%;float:left;}
    	.mui-bar-nav b{color:#EC971F;}
    	#mapwarp{top:0;bottom:0;position:absolute;left:0;right:0;}
    </style>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=c2660934bdd79ee31dc6f30113f44d85"></script>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a href='#change-point'>地区检索</a>
		<a href='#change-xm'>服务项目</a>
		<span id='display_in_list'><b class="mui-icon mui-icon-list"></b>列表显示</span>
	</header>
	<div id='mapwarp'></div>
	<div id="change-point" class="mui-popover">
        <ul class="mui-table-view">
			<li class="mui-table-view-cell"><a href="#">江汉路步行街</a></li>
			<li class="mui-table-view-cell"><a href="#">光谷/鲁巷</a></li>
			<li class="mui-table-view-cell"><a href="#">武汉广场</a></li>
			<li class="mui-table-view-cell"><a href="#">六渡桥</a></li>
			<li class="mui-table-view-cell"><a href="#">西北湖</a></li>
			<li class="mui-table-view-cell"><a href="#">万松园</a></li>
			<li class="mui-table-view-cell"><a href="#">阅马场</a></li>
			<li class="mui-table-view-cell"><a href="#">徐东大街</a></li>
			<li class="mui-table-view-cell"><a href="#">唐家墩/菱角湖</a></li>
			<li class="mui-table-view-cell"><a href="#">汉口火车站</a></li>
			<li class="mui-table-view-cell"><a href="#">武胜路</a></li>
			<li class="mui-table-view-cell"><a href="#">宝丰</a></li>
			<li class="mui-table-view-cell"><a href="#">硚口路</a></li>
			<li class="mui-table-view-cell"><a href="#">汉西路</a></li>
			<li class="mui-table-view-cell"><a href="#">古田路</a></li>
			<li class="mui-table-view-cell"><a href="#">客运港/江滩</a></li>
			<li class="mui-table-view-cell"><a href="#">港澳台风情街</a></li>
			<li class="mui-table-view-cell"><a href="#">解放公园</a></li>
			<li class="mui-table-view-cell"><a href="#">花桥</a></li>
			<li class="mui-table-view-cell"><a href="#">后湖</a></li>
			<li class="mui-table-view-cell"><a href="#">百步亭/二七</a></li>
			<li class="mui-table-view-cell"><a href="#">武昌火车站</a></li>
			<li class="mui-table-view-cell"><a href="#">楚河汉街</a></li>
			<li class="mui-table-view-cell"><a href="#">阅马场</a></li>
			<li class="mui-table-view-cell"><a href="#">司门口</a></li>
			<li class="mui-table-view-cell"><a href="#">积玉桥</a></li>
			<li class="mui-table-view-cell"><a href="#">徐东大街</a></li>
			<li class="mui-table-view-cell"><a href="#">大东门/小东门</a></li>
			<li class="mui-table-view-cell"><a href="#">石牌岭/街道口</a></li>
			<li class="mui-table-view-cell"><a href="#">中南路</a></li>
			<li class="mui-table-view-cell"><a href="#">水果湖</a></li>
			<li class="mui-table-view-cell"><a href="#">丁字桥</a></li>
			<li class="mui-table-view-cell"><a href="#">珞珈山</a></li>
			<li class="mui-table-view-cell"><a href="#">汉阳大道</a></li>
			<li class="mui-table-view-cell"><a href="#">桥口路</a></li>
			<li class="mui-table-view-cell"><a href="#">余家头</a></li>
			<li class="mui-table-view-cell"><a href="#">藏龙岛</a></li>
			<li class="mui-table-view-cell"><a href="#">纸坊</a></li>
			<li class="mui-table-view-cell"><a href="#">大花岭</a></li>
			<li class="mui-table-view-cell"><a href="#">庙山</a></li>
        </ul>
    </div>
	<div id="change-xm" class="mui-popover">
        <ul class="mui-table-view">
			<li class="mui-table-view-cell"><a href="#">洗车</a></li>
			<li class="mui-table-view-cell"><a href="#">打蜡</a></li>
			<li class="mui-table-view-cell"><a href="#">内饰清洁</a></li>
			<li class="mui-table-view-cell"><a href="#">封釉</a></li>
			<li class="mui-table-view-cell"><a href="#">镀膜</a></li>
			<li class="mui-table-view-cell"><a href="#">镀晶</a></li>
			<li class="mui-table-view-cell"><a href="#">车窗贴膜</a></li>
			<li class="mui-table-view-cell"><a href="#">改色贴膜</a></li>
			<li class="mui-table-view-cell"><a href="#">方向盘套</a></li>
			<li class="mui-table-view-cell"><a href="#">钣金油漆</a></li>
			<li class="mui-table-view-cell"><a href="#">划痕修复</a></li>
			<li class="mui-table-view-cell"><a href="#">轮毂翻新</a></li>
			<li class="mui-table-view-cell"><a href="#">更换雨刮</a></li>
			<li class="mui-table-view-cell"><a href="#">四轮定位</a></li>
			<li class="mui-table-view-cell"><a href="#">机油保养</a></li>
			<li class="mui-table-view-cell"><a href="#">动力平衡</a></li>
			<li class="mui-table-view-cell"><a href="#">灯光升级</a></li>
			<li class="mui-table-view-cell"><a href="#">音响升级</a></li>
			<li class="mui-table-view-cell"><a href="#">底盘装甲</a></li>
			<li class="mui-table-view-cell"><a href="#">倒车影像</a></li>
			<li class="mui-table-view-cell"><a href="#">导航安装</a></li>
			<li class="mui-table-view-cell"><a href="#">隔音处理</a></li>
			<li class="mui-table-view-cell"><a href="#">更换轮胎</a></li>
			<li class="mui-table-view-cell"><a href="#">补胎补气</a></li>
        </ul>
    </div>
<script>
var parentView,selfView,retry=true;
var mapObj,toolBar,
	marker = [],
	windowsArr = [];
	
function clearMaker(){
	for(var l=marker.length-1;l>=0;l--){
		marker[l].setMap(null);
	}
	windowsArr = [];
}

function mapInit() {
	mapObj = new AMap.Map("mapwarp",{
		dragEnable:true,
		zoomEnable:true,
		zooms:[3,18],
		view: new AMap.View2D({
			zoom:14
		})
	});
	mapObj.plugin(["AMap.ToolBar"],function(){	
		toolBar = new AMap.ToolBar();
		mapObj.addControl(toolBar);
        AMap.event.addListener(toolBar, "location", function(e){
//      	手动打点
        	if(e.lnglat)
        	mui.fire(parentView,'listen',{lnglat:e.lnglat.lng+','+e.lnglat.lat});
        	else
        	mui.fire(parentView,'listen');
        });
		toolBar.doLocation();
	});
	
	AMap.event.addListener(mapObj,'click',function(e){
        mui.fire(parentView,'listen',{lnglat:e.lnglat.lng+','+e.lnglat.lat});
        mapObj.setZoomAndCenter(14,new AMap.LngLat(e.lnglat.lng,e.lnglat.lat));
	});

//	mapObj.plugin('AMap.CloudDataLayer', function () {
//		var layerOptions = {
//			query:{keywords: '_service:美容'}, 
//			clickable:true
//		};
//		var cloudDataLayer = new AMap.CloudDataLayer('5476c83be4b068ad0ea3ad74', layerOptions);
//		cloudDataLayer.setMap(mapObj);
//
//		AMap.event.addListener(cloudDataLayer, 'click', function (result) {
//			var clouddata = result.data;
//			var infoWindow = new AMap.InfoWindow({
//				content:"<h3><font face=\"微软雅黑\"color=\"#3366FF\">"+ clouddata._name +"</font></h3><hr />地址："+ clouddata._address + "<br />" + "创建时间：" + clouddata._createtime+ "<br />" + "更新时间：" + clouddata._updatetime,
//      		size:new AMap.Size(300, 0),
//      		autoMove:true,
//      		offset:new AMap.Pixel(0,-25)
//			});
//			infoWindow.open(mapObj, clouddata._location);
//		});
//	});
}

window.addEventListener('mapinit',function(){
	parentView = plus.webview.currentWebview().parent();
	mapInit();
});

//手动打点
function addmarker(i, d) {
	var lnglat = d._location.split(',');
	var point = new AMap.LngLat(lnglat[0], lnglat[1]);

    var markerOption = {
        map:mapObj,
        position:point
    };

    var mar = new AMap.Marker(markerOption);
    marker.push(mar);

    var infoWindow = new AMap.InfoWindow({
        content:"<h3><font face=\"微软雅黑\"color=\"#3366FF\">"+(i+1) + "."+ d._name +"</font></h3><hr />地址："+ d._address,
        size:new AMap.Size(300, 0),
        autoMove:true,
        offset:new AMap.Pixel(0,-30)
    });  

    windowsArr.push(infoWindow);   
    var aa = function(){infoWindow.open(mapObj, mar.getPosition());};  
    AMap.event.addListener(mar, "click", aa);  
}

mui('.mui-bar-nav').on('tap','#change-point',function(){
	
});

mui.plusReady(function(){
	selfView = plus.webview.currentWebview();

	mui('.mui-bar-nav').on('tap','#display_in_list',function(){
		mui.fire(parentView,'showList')
	});
	
//手动打点
	window.addEventListener('catchData',function(e){
		clearMaker();
		if(e.detail.count>0){
			for (var i = 0; i < e.detail.count; i++) {
		        addmarker(i, e.detail.datas[i]);
		    }
//	    	mapObj.setFitView();
		}else if(retry){
			retry = false;
			mui.fire(parentView,'listen',{radius:6000});
		}
	});

	function showLoading(text){
		loadingWindow = plus.nativeUI.showWaiting(text || '');
	}
	function closeLoading(){
		loadingWindow.close();
	}
});

</script>
</body>
</html>